
<%-include("../../views/user/partials/header")%>
<head>  
  <!-- iziToast CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/izitoast/dist/css/iziToast.min.css">
  <style>
    .offer__percentage {
      color: #ff0000;
      font-size: 0.8em;
      margin-left: 10px;
    }
  </style>
</head>


    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== HOME ===============-->
      <section class="home section--lg">
        <div class="home__container container grid">
          <div class="home__content">
            <span class="home__subtitle">Deal of the day</span>
            <h1 class="home__title">
              Legendary <span>adidas Predator</span>
            </h1>
            <p class="home__description">
              Save more with coupons & up tp 20% off
            </p>
            <a href="/shop" class="btn">Shop Now</a>
          </div>
          <img src="/assets/img/Boots/Adidas/AdidasBoots2.10.webp" class="home__img" alt="hats" />
        </div>
      </section>

      <!--=============== CATEGORIES ===============-->
      <section class="categories container section">
        <h3 class="section__title"><span>Popular</span> Categories</h3>
        <div class="categories__container swiper">
          <div class="swiper-wrapper">
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Home page/HomePage7.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Jerseys</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Home page/HomePage8.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Gloves</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Home page/HomePage9.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Boots</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Category Page/Category3.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Footballs</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Home page/ShinGuard2.1.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Shin Guards</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Home page/HomePage4.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Boots</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Home page/HomePage3.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Gloves</h3>
            </a>
            <a href="/shop" class="category__item swiper-slide">
              <img
                src="/assets/img/Category Page/Category3.webp"
                alt=""
                class="category__img"
              />
              <h3 class="category__title">Footballs</h3>
            </a>
          </div>

          <div class="swiper-button-prev">
            <i class="fi fi-rs-angle-left"></i>
          </div>
          <div class="swiper-button-next">
            <i class="fi fi-rs-angle-right"></i>
          </div>
        </div>
      </section>

      <!--=============== PRODUCTS ===============-->
      <section class="products container section">
        <div class="tab__btns">
          <span class="tab__btn active-tab" data-target="#featured"
            >Branded</span
          >
          <span class="tab__btn" data-target="#popular">Popular</span>
          <span class="tab__btn" data-target="#new-added">New Added</span>
        </div>

      <div class="tab__items">
          <!-- Branded section  -->
          <div class="tab__item active-tab" content id="featured">
            <div class="products__container grid">
              <% products.branded.forEach(function(product) { %>
                <div class="product__item">
                  <div class="product__banner">
                    <a href="/productDetails?id=<%=product._id%>" class="product__images">
                      <img
                        src="<%=product.images[0]%>"
                        alt="<%=product.name%>"
                        class="product__img default"
                      />
                      <img
                        src="<%=product.images[1]%>"
                        alt="<%=product.name%>"
                        class="product__img hover"
                      />
                    </a>
                    <div class="product__actions">
                      <a href="/productDetails?id=<%=product._id%>" class="action__btn" aria-label="Quick View">
                        <i class="fi fi-rs-eye"></i>
                      </a>
                      <a
                        href="#"
                        class="action__btn wishlist-btn"
                        aria-label="Add to Wishlist"
                        data-product-id="<%=product._id%>"
                      >
                        <i class="fi fi-rs-heart"></i>
                      </a>
                      <a href="#" class="action__btn" aria-label="Compare">
                        <i class="fi fi-rs-shuffle"></i>
                      </a>
                    </div>
                    <div class="product__badge light-orange">Hot</div>
                  </div>
                  <div class="product__content">
                    <span class="product__category"><%=product.brand%></span>
                    <a href="details.html">
                      <h3 class="product__title"><%=product.name%></h3>
                    </a>
                    <div class="product__rating">
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                    </div>
                    <div class="product__price flex">
                      <% 
                        let categoryOffer = product.category && product.category.categoryOffer || 0;
                        let productOffer = product.productOffer ? product.offerPercentage : 0;
                        let effectiveOffer = Math.max(categoryOffer, productOffer); // Use higher offer
                        if (product.productOffer && productOffer > 0) {
                          effectiveOffer = productOffer; // Always use product offer if it exists
                        }
                        let originalPrice = product.combos[0].regularPrice;
                        let salePriceBeforeDiscount = product.combos[0].salesPrice;
                        let newSalesPrice = salePriceBeforeDiscount - (salePriceBeforeDiscount * (effectiveOffer / 100));
                      %>
                      <% if (effectiveOffer > 0) { %>
                        <span class="new__price">₹<%= newSalesPrice.toFixed(2) %></span>
                        <span class="old__price">₹<%= salePriceBeforeDiscount %></span>
                        <span class="offer__percentage">(-<%= effectiveOffer %>%)</span>
                      <% } else { %>
                        <span class="new__price">₹<%= salePriceBeforeDiscount %></span>
                        <span class="old__price">₹<%= originalPrice %></span>
                      <% } %>
                    </div>
                    <a
                    href="#"
                    class="action__btn cart__btn"
                    aria-label="Add To Cart"
                    data-product-id="<%= product._id %>"
                    data-combo-size="<%= product.combos[0].size %>"
                  >
                    <i class="fi fi-rs-shopping-bag-add"></i>
                  </a>
                  </div>
                </div>
              <% }); %>
            </div>
          </div>

          <!-- Popular section  -->
          <div class="tab__item" content id="popular">
            <div class="products__container grid">
              <% products.popular.forEach(function(product) { %>
                <div class="product__item">
                  <div class="product__banner">
                    <a href="/productDetails?id=<%=product._id%>" class="product__images">
                      <img
                        src="<%=product.images[0]%>"
                        alt="<%=product.name%>"
                        class="product__img default"
                      />
                      <img
                        src="<%=product.images[1]%>"
                        alt="<%=product.name%>"
                        class="product__img hover"
                      />
                    </a>
                    <div class="product__actions">
                      <a href="/productDetails?id=<%=product._id%>" class="action__btn" aria-label="Quick View">
                        <i class="fi fi-rs-eye"></i>
                      </a>
                      <a
                        href="#"
                        class="action__btn wishlist-btn"
                        aria-label="Add to Wishlist"
                        data-product-id="<%=product._id%>"
                      >
                        <i class="fi fi-rs-heart"></i>
                      </a>
                      <a href="#" class="action__btn" aria-label="Compare">
                        <i class="fi fi-rs-shuffle"></i>
                      </a>
                    </div>
                    <div class="product__badge light-orange">Hot</div>
                  </div>
                  <div class="product__content">
                    <span class="product__category"><%=product.brand%></span>
                    <a href="details.html">
                      <h3 class="product__title"><%=product.name%></h3>
                    </a>
                    <div class="product__rating">
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                      <i class="fi fi-rs-star"></i>
                    </div>
                    <div class="product__price flex">
                      <span class="new__price">₹<%=product.combos[0].salesPrice%></span>
                      <span class="old__price">₹<%=product.combos[0].regularPrice%></span>
                    </div>
                    <a
                      href="#"
                      class="action__btn cart__btn"
                      aria-label="Add To Cart"
                      data-combo-size="<%= product.combos[0].size %>"
                    >
                      <i class="fi fi-rs-shopping-bag-add"></i>
                    </a>
                  </div>
                </div>
              <% }); %>
            </div>
          </div>

          <!-- New added section  -->
        <div class="tab__item" content id="new-added">
          <div class="products__container grid">
            <% products.newAdded.forEach(function(product) { %>
              <div class="product__item">
                <div class="product__banner">
                  <a href="/productDetails?id=<%=product._id%>" class="product__images">
                    <img
                      src="<%=product.images[0]%>"
                      alt="<%=product.name%>"
                      class="product__img default"
                    />
                    <img
                      src="<%=product.images[1]%>"
                      alt="<%=product.name%>"
                      class="product__img hover"
                    />
                  </a>
                  <div class="product__actions">
                    <a href="/productDetails?id=<%=product._id%>" class="action__btn" aria-label="Quick View">
                      <i class="fi fi-rs-eye"></i>
                    </a>
                    <a
                      href="#"
                      class="action__btn wishlist-btn"
                      aria-label="Add to Wishlist"
                      data-product-id="<%=product._id%>"
                    >
                      <i class="fi fi-rs-heart"></i>
                    </a>
                    <a href="#" class="action__btn" aria-label="Compare">
                      <i class="fi fi-rs-shuffle"></i>
                    </a>
                  </div>
                  <div class="product__badge light-orange">Hot</div>
                </div>
                <div class="product__content">
                  <span class="product__category"><%=product.brand%></span>
                  <a href="details.html">
                    <h3 class="product__title"><%=product.name%></h3>
                  </a>
                  <div class="product__rating">
                    <i class="fi fi-rs-star"></i>
                    <i class="fi fi-rs-star"></i>
                    <i class="fi fi-rs-star"></i>
                    <i class="fi fi-rs-star"></i>
                    <i class="fi fi-rs-star"></i>
                  </div>
                  <div class="product__price flex">
                    <span class="new__price">₹<%=product.combos[0].salesPrice%></span>
                    <span class="old__price">₹<%=product.combos[0].regularPrice%></span>
                  </div>
                  <a
                    href="#"
                    class="action__btn cart__btn"
                    aria-label="Add To Cart"
                    data-combo-size="<%= product.combos[0].size %>"
                  >
                    <i class="fi fi-rs-shopping-bag-add"></i>
                  </a>
                </div>
              </div>
            <% }); %>
          </div>
        </div>
      </div>
      </section>
      
      <!--=============== NEWSLETTER ===============-->
      <section class="newsletter section home__newsletter">
        <div class="newsletter__container container grid">
          <h3 class="newsletter__title flex">
            <img
              src="./assets/img/icon-email.svg"
              alt=""
              class="newsletter__icon"
            />
            Sign in to Newsletter
          </h3>
          <!-- <p class="newsletter__description">
            ...and receive $25 coupon for first shopping.
          </p> -->
          <form action="" class="newsletter__form">
            <input
              type="text"
              placeholder="Enter Your Email"
              class="newsletter__input"
            />
            <button type="submit" class="newsletter__btn">Subscribe</button>
          </form>
        </div>
      </section>
    </main>
    <!-- Footer Section Begin -->
<%-include("../../views/user/partials/footer")%>

 <!-- iziToast JS -->
 <script src="https://cdn.jsdelivr.net/npm/izitoast/dist/js/iziToast.min.js"></script>
 <script src="/assets/js/user/wishlist.js"></script>

 <script>
document.addEventListener('DOMContentLoaded', function() {
  const cartButtons = document.querySelectorAll('.cart__btn');

  cartButtons.forEach(button => {
    button.addEventListener('click', function(event) {
      event.preventDefault();
      const productItem = this.closest('.product__item');
      
      const productLink = productItem.querySelector('a[href^="/productDetails"]');
      
      if (!productLink) {
        console.error('Product link not found');
        iziToast.error({
          title: 'Error',
          message: 'Could not find product details',
          position: 'topRight'
        });
        return;
      }

      const productId = new URL(productLink.href, window.location.origin).searchParams.get('id');
      
      if (!productId) {
        console.error('Product ID not found');
        iziToast.error({
          title: 'Error',
          message: 'Could not extract product ID',
          position: 'topRight'
        });
        return;
      }
      
      const selectedCombo = {
        size: this.getAttribute('data-combo-size')
      };

      console.log('Adding to cart - Product ID:', productId, 'Size:', selectedCombo.size);

      fetch('/add-to-cart', {
        method: 'POST',
        credentials: 'same-origin',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ 
          productId, 
          quantity: 1,
          selectedCombo 
        })
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(errorData => {
            throw new Error(errorData.message || 'Network response was not ok');
          });
        }
        return response.json();
      })
      .then(data => {
        if (data.success) {
          iziToast.success({
            title: 'Success',
            message: 'Product added to cart successfully!',
            position: 'topRight'
          });
        } else {
          if (data.limitExceeded) {
            iziToast.warning({
              title: 'Cart Limit',
              message: data.message || 'You can only add up to 10 units per product or 50 items total.',
              position: 'topRight'
            });
          } else {
            iziToast.error({
              title: 'Error',
              message: data.message || 'Failed to add product to cart',
              position: 'topRight'
            });
          }
        }
      })
      .catch(error => {
        console.error('Fetch error:', error);
        iziToast.error({
          title: 'Error',
          message: error.message || 'An error occurred while adding to cart',
          position: 'topRight'
        });
      });
    });
  });
});
 </script>